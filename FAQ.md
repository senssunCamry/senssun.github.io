# 常见问题

## APP逻辑设计相关

### 是否需要绑定或配对设备？

这里需要弄清一个概念，问题中提到的绑定或配对，是指在安卓/iOS中添加配对的蓝牙设备。通常一些标准设备是会需要的，比如蓝牙耳机，手环。这些会需要在手机系统的蓝牙设置进行设置。但我们的秤不用蓝牙设置进行设置，具体我们会在如下说明

蓝牙4.0，也就是BLE，是不需要绑定蓝牙设备就可以直接使用。我们的秤使用的私有协议，无法通过手机系统蓝牙直接使用，市面上面几乎所有的体脂秤都是如此。我们APP（MovingLife）中的添加设备，仅仅让APP记住用户的秤，并非是手机系统的蓝牙配对。添加设备的过程也是引导用户如何使用体脂称。

客户这边可自行决定是否需要添加该逻辑，建议如果是做成APP的一个小功能模块，是可以直接做成直接上秤测量，展示数据。

### 如何做成用户踩秤后，APP马上响应

我们自己的APP（MovingLife），在正常使用中，是让用户打开APP，有操作指引提示，一步步按步骤进入测量，这样可以减少用户的误操作。  其实 ，就是打开APP后，APP自动调用SDK的一整套逻辑，无需用户点击选择设备之类的。点击选择设备这些相关的逻辑处理，需要开发者根据需要加入。具体实现步骤如下：

1. 进入测量界面后，检查蓝牙状态
2. 蓝牙已打开，开始扫描
3. 扫描到体脂秤，判断是否为已添加设备或者无需判断就直接连接（该处视APP的逻辑不同而不同）
4. 连接成功，展示测量动画
5. 测量完成，展示测量结果

### 测量完成后，是否需要立马断开蓝牙连接

通常无需主动断开与秤的连接，除非用户退出测量界面。

如果需要测量立马断开连接，最好也能够延时2s断开。我们早期的一些成功，如果测量完成立马断开，秤可能出现意想不到的现象。

### 数据如何分析

一个数据是否标准、偏低等，这个可以参考我们的[SDK指标标准描述]。

我们的Demo中未展示数据的分析，需要开发人员自行把对应秤体的指标标准加入程序中处理。可以参考我司的APP的身体报告的指标显示



## 算法配置文件相关

### account与配置文件是什么？分别有什么作用？

account和password是senssun为客户创建的唯一标识，会在我们后台进行登记，一个给定account，通常是一直不会变化。demo中的test这个account是我们测试以及让客户体验用的账号，该账号的特性不稳定，随时可能会进行修改。如果已经达成正式合作意向，建议还是向我们都是商务或销售申请专用账号和密码使用。

配置文件是配合用户账号使用的一些数据，约定了型号、算法、指标等一些信息。不同的客户要求会所有不同，所以我们把客户定制化要求封装在该配置文件中。

### 不同客户端是否可以使用同一个account

安卓和iOS是可以用一个account，小程序 和 SDK的account暂时不能使用同一个

### SDK是否为离线的？它会向香山云云端发送什么数据？

SDK是离线模式的，SDK不会外发送任何网络请求到云端服务器上

目前只有算法对接就发送到云端服务器返回测量指标数据。



### 初始化提示appid错误

- 检查初始化文件和使用的appid是否匹配
- 检查引入的SDK是否是最新的

### 测量完成后返回的数据缺失指标

如果是只有体重和BMI的数据可以参考[测量完成后没有体脂率等数据](FAQ.md#测量完成后没有体脂率等数据).

如果能够测到体脂率，但是缺失自己想要的指标，该情况通常是包含该指标，需要跟我司商务/销售沟通，增加该指标。



## SDK功能相关

### 是否能判断秤是否灭屏？

对于`普通蓝牙秤`和`双模秤`来说，秤体的屏幕不亮时，是扫描不到秤体的，指不过对于一些秤来说，息屏的时候就会断开连接。



对于`广播秤`来说，能够扫描到设备，就是已开机的状态，扫描不到，通常就是未开机。

### 连接设备一直无法成功或者成功后很快就断开连接

- 检查设备是否被其他人连接了
- 在系统蓝牙中查看是否当前连接的设备已经被配对,如果已经配对，需要取消配对
- 部分手机需要先扫描才能连接成功，先扫描设备再进行连接

### SDK返回无定位权限错误

- 检查是否对**ACCESS_COARSE_LOCATION**和**ACCESS_FINE_LOCATION**都进行了申请，不打开这两个权限，蓝牙是扫描不到附近的蓝牙秤体设备

  

- 是否编译版本26以及以上，如果是，2个权限都需要单独申请(8.0的新特性)

  > 安卓6.0以上，谷歌把蓝牙归类为定位功能的一部分，使用蓝牙扫描时，需要用户授权定位权限，不然调用扫描时，系统会提示需要定位权限 相当一部分手机（大约有1/3的样子，不打开定位服务开关时，也是无法扫描到设备，原生大多数如此，而国产系统会对此有些优化，就不一定了）

### SDK返回错误的文件,确认文件位置无异常，确认文件在demo中使用无异常

- 检查是否有添加so库
- 检查是否打包的apk文件中含有so库

### 数据或者设备等监听回调，同一时间回调多次

- 先确定是否，设置了多次监听。当监听不使用时，一定要设置为null

  

### 测量完成后没有体脂率等数据

1. 检查资料是否正确，主要是生日（用来计算年龄）、身高这两个参数，是否超出正常值范围
2. 是否有脱鞋进行测量。穿鞋测量时，无法测到生物阻抗，所以无法计算体脂率等指标

### 扫描不到设备，该如何处理

1. 检查是否打开蓝牙、是否有踩亮秤，手机是否跟秤相距过远（超过10米）
2. 检查所扫描的设备，是否已经被其他人连接
3. 如果是Android，则可以检查下是否有定位权限，另外是否有打开定位服务开关
4. 尝试重启蓝牙，再不行，打开关闭开启蓝牙，还是搜不到的话，关机重启手机



## 其他问题

### 是否可以给到体脂率等指标的计算方法？

这些指标的算法属于我司机密，无法提供。

### 什么是秤端存储数据

普通蓝牙秤在称重时未连接手机的情况下，秤会把数据存在秤体内，等下次连接蓝牙时，会把这些数据传给APP，由于SDK无法识别该用户是谁的，所以会把这个数据交由APP来分配，分配用户可以交给SDK来计算完整数据。

SDK用户的识别逻辑的处理部分需要开发人员自行处理

广播秤是不存在秤体存数据的，只会发送当前的数据，历史的数据信息需要APP自行处理这块逻辑

### 可否提供蓝牙协议

原则上我们不会提供蓝牙协议，如果实在需要，可以跟我们的商务/销售沟通

### 为什么我们使用SDK测量出来的数据其它厂商数据会有差异

senssun有几套算法，不同的设备可能使用的不同算法。



SDK中的算法机制通常为统一的某种算法，不可变的。也就是说，同一个秤使用我司的APP测量与使用SDK进行测量，计算资料和体重一样，也有可能有会不少的差异。所以，我司不建议使用我司APP和SDK的测量数据进行对比，客户只需要关心给到的算法是否合适，是否稳定即可。

### 线上版本出现蓝牙连接异常后，怎么排查问题

先查清用户的手机型号，如果可以的话，尽量使用跟客户同样的型号来测试。

注册日志输出，记录相关日志（可以保存日志文件），发给我司开发人员进行分析。

### 搜索到蓝牙并连接上后，等秤测量后稳定时，稳定就是秤体反复闪烁几次后，再下秤体，会返回测量完成的标志，才会测量到脂肪数据。

